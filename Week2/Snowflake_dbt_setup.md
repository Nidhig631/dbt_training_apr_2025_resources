**-- Use an admin role**

USE ROLE ACCOUNTADMIN;

**-- Create the transform role**

CREATE ROLE IF NOT EXISTS TRANSFORM;

GRANT ROLE TRANSFORM TO ROLE SYSADMIN;

**-- Create the default warehouse if necessary**

CREATE WAREHOUSE IF NOT EXISTS COMPUTE_WH;

GRANT OPERATE ON WAREHOUSE COMPUTE_WH TO ROLE TRANSFORM;

**-- Create the dbt user and assign to role**

CREATE USER IF NOT EXISTS dbt 
PASSWORD='dbtPassword123' 
LOGIN_NAME='dbt' 
MUST_CHANGE_PASSWORD=FALSE 
DEFAULT_WAREHOUSE='COMPUTE_WH' 
DEFAULT_ROLE=TRANSFORM 
DEFAULT_NAMESPACE='DEV.BRONZE_AIRBNB' 
COMMENT='DBT user used for data transformation'; 

GRANT ROLE TRANSFORM to USER dbt;

**-- Create our database and schemas**

CREATE DATABASE IF NOT EXISTS DEV;

CREATE SCHEMA IF NOT EXISTS DEV.BRONZE_AIRBNB;

CREATE SCHEMA IF NOT EXISTS DEV.SILVER_AIRBNB;

CREATE SCHEMA IF NOT EXISTS DEV.GOLD_AIRBNB;

CREATE SCHEMA IF NOT EXISTS DEV.PLATINUM_AIRBNB;

**-- Set up permissions to role transform**

**--For schema BRONZE_AIRBNB**

GRANT ALL ON WAREHOUSE COMPUTE_WH TO ROLE TRANSFORM;

GRANT ALL ON DATABASE DEV to ROLE TRANSFORM;

GRANT ALL ON ALL SCHEMAS IN DATABASE DEV to ROLE TRANSFORM;

GRANT ALL ON FUTURE SCHEMAS IN DATABASE DEV to ROLE TRANSFORM;

GRANT ALL ON ALL TABLES IN SCHEMA DEV.BRONZE_AIRBNB to ROLE TRANSFORM;

GRANT ALL ON FUTURE TABLES IN SCHEMA DEV.BRONZE_AIRBNB to ROLE TRANSFORM;

**--For SCHEMA SILVER_AIRBNB**

GRANT ALL ON ALL TABLES IN SCHEMA DEV.SILVER_AIRBNB to ROLE TRANSFORM;

GRANT ALL ON FUTURE TABLES IN SCHEMA DEV.SILVER_AIRBNB to ROLE TRANSFORM;

**--For SCHEMA GOLD_AIRBNB**

GRANT ALL ON ALL TABLES IN SCHEMA DEV.GOLD_AIRBNB to ROLE TRANSFORM;

GRANT ALL ON FUTURE TABLES IN SCHEMA DEV.GOLD_AIRBNB to ROLE TRANSFORM;

**--For SCHEMA PLATINUM_AIRBNB**

GRANT ALL ON ALL TABLES IN SCHEMA DEV.PLATINUM_AIRBNB to ROLE TRANSFORM;

GRANT ALL ON FUTURE TABLES IN SCHEMA DEV.PLATINUM_AIRBNB to ROLE TRANSFORM;
